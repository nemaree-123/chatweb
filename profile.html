<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Chatverse â€” Profile</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="container">
    <div class="navbar card">
      <div class="brand">
        <div class="logo">CV</div>
        <div>
          <div style="font-weight:700">Chatverse</div>
          <div class="small">Profile</div>
        </div>
      </div>
      <div class="navlinks">
        <a href="home.html">Home</a>
        <a href="chat.html">Chat</a>
        <a href="users.html">Users</a>
        <a href="profile.html" class="active">Profile</a>
        <a id="logoutBtn" style="cursor:pointer" class="small">Logout</a>
      </div>
    </div>

    <div style="margin-top:18px" class="card" id="profileCard">
      <h2>Your profile</h2>
      <div id="profileInfo" style="display:flex;gap:18px;align-items:center">
        <div id="avatar" style="width:88px;height:88px;border-radius:12px;background:rgba(255,255,255,0.03);display:flex;align-items:center;justify-content:center;font-size:24px">U</div>
        <div style="flex:1">
          <div id="fullname" style="font-weight:700">Full name</div>
          <div class="small" id="uname">@username</div>
        </div>
      </div>
    </div>
  </div>

<script type="module">
import { auth, onAuthStateChanged, db, doc, getDoc, signOutUser } from './firebase.js';

let me = null;
onAuthStateChanged(async user => {
  if (!user) return window.location.href = 'login.html';
  me = user;
  loadProfile();
  // update presence
  (await import('./firebase.js')).setPresence(me.uid);
});

document.getElementById('logoutBtn').addEventListener('click', async () => {
  await signOutUser();
  window.location.href = 'login.html';
});

async function loadProfile() {
  const docRef = doc(db, "users", me.uid);
  const snap = await getDoc(docRef);
  if (!snap.exists()) return;
  const data = snap.data();

  document.getElementById('fullname').textContent = data.fullName || (data.firstName + " " + data.lastName) || 'Unknown';
  document.getElementById('uname').textContent = '@' + (data.username || (me.email ? me.email.split('@')[0] : ''));
  document.getElementById('avatar').textContent = (data.firstName || data.username || 'U')[0].toUpperCase();
}
</script>
</body>
</html>
